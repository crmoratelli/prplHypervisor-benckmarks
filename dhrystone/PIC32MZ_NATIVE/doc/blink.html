<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.org">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<TITLE>PIC32MZ2048EFM144 Minimal Working Sample.</TITLE>

<!-- Included tutorial.css -->
<STYLE TYPE="text/css">
pre {

	background-color:#E0E0E0  ;
	}

</STYLE>

</HEAD><BODY BGCOLOR="white" TEXT="black">
<CENTER>
<H1>PIC32MZ2048EFM144 Minimal Working Sample.</H1>
</CENTER>

<P></P>
<HR NOSHADE SIZE=1>
<P></P>

  <OL>
  <LI><A HREF="#toc1">Introduction</A>
  <LI><A HREF="#toc2">Pre-Requisits</A>
  <LI><A HREF="#toc3">Deployment</A>
  <LI><A HREF="#toc4">Considerations</A>
  </OL>

<P></P>
<HR NOSHADE SIZE=1>
<P></P>

<A NAME="toc1"></A>
<H1>1. Introduction</H1>

<P>
This mini how-to is intended to show how to compile a minimal working application to the PIC32MZ2048EFM144 Microchip SoC without using the MPLABX compiler or linker scripts.
</P>

<A NAME="toc2"></A>
<H1>2. Pre-Requisits</H1>

 <UL>
 <LI>PIC32MZ Embedded Connectivity Starter Kit board.
 <LI>MPLABX IPE already installed (used to flash the bootloader for the first time).
 <LI>MIPS-MTI toolchain already installed. 
 </UL>

<P>
Tested on Ubuntu 14.04 LTS.
</P>

<A NAME="toc3"></A>
<H1>3. Deployment</H1>

<P>
1) Use the MPLABX IPE to flash the Microchip_UART.hex to the board.
</P>

    <UL>
    <LI>After flashed, the LED1 will keep blinking showing the that the bootloader is ready to upload a hex file.
    </UL>

<P>
2) Compile the blink.c sample using the MIPS-MTI toolchain using "make blink."
</P>

<PRE>
  #: make blink
  
  mips-mti-elf-as -EL -msoft-float -o crt0.o crt0.s
  mips-mti-elf-gcc -EL -O2 -c -mabi=32 -mno-check-zero-division -msoft-float -fshort-double -ffreestanding -nostdlib -fomit-frame-pointer -G 0 -I ./include -DCPU_SPEED=200000000  -o blink.o blink.c
  mips-mti-elf-ld  -Tpic32mz.ld -Map blink.map -N -o blink.elf \
                  crt0.o blink.o
  mips-mti-elf-objdump --disassemble --reloc blink.elf &gt; blink.lst
  mips-mti-elf-objdump -h blink.elf &gt; blink.sec
  mips-mti-elf-objdump -s blink.elf &gt; blink.cnt
  mips-mti-elf-objcopy -O binary blink.elf blink.bin
  mips-mti-elf-objcopy -O ihex --change-addresses=0x80000000 blink.elf blink.hex
  mips-mti-elf-size blink.elf
     text    data     bss     dec     hex filename
     4512       0       0    4512    11a0 blink.elf
</PRE>

<P>
3) Upload the resulting blink.hex file to the board using "make load". For this, use a second USB cable to connect to the board's UART port. 
</P>

<PRE>
  #: make load
  
  stty 115200 raw cs8 -parenb -crtscts clocal cread ignpar ignbrk -ixon -ixoff -ixany -brkint -icrnl -imaxbel -opost -onlcr -isig -icanon -iexten -echo -echoe -echok -echoctl -echoke -F /dev/ttyACM0
  ./pic32prog -d /dev/ttyACM0 blink.hex 
  Programmer for Microchip PIC32 microcontrollers, Version 2.0.186
      Copyright: (C) 2011-2015 Serge Vakulenko
        Adapter: STK500v2 Bootloader
   Program area: 1d000000-1d1fffff
      Processor: Bootloader
   Flash memory: 2048 kbytes
    Boot memory: 80 kbytes
           Data: 4512 bytes
          Erase: done
  Program flash: ###### done
   Verify flash: ##### done
   Program rate: 3359 bytes per second
  
</PRE>

<P>
4) If all LEDs start to blink, it worked! You can open the UART port and see the "Hello World!" message being printed. 
</P>

<PRE>
  #: cat /dev/ttyACM0 
  Hello World!
  Hello World!
  Hello World!
  Hello World!
  Hello World!
  Hello World!
  Hello World!
  ...
</PRE>

<A NAME="toc4"></A>
<H1>4. Considerations</H1>

<UL>
<LI>Upload a new application to the board requires turn off the board. 
<LI>On power on, the board will always stop at the bootloader waiting for upload an application. 
    <UL>
    <LI>This is for debugging purposes only. 
    </UL>
</UL>

<!-- html code generated by txt2tags 2.6 (http://txt2tags.org) -->
<!-- cmdline: txt2tags blink.txt -->
</BODY></HTML>
